# .github/workflows/ci.yaml
name: Continuous Integration - Build e Testes

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

  jobs:
    build:
      name: Build & Test
      runs-on: ubuntu-latest
  
      services:
        postgres:
          image: postgres:15
          ports: ['5432:5432']
          env:
            POSTGRES_USER: postgres
            POSTGRES_PASSWORD: postgres
            POSTGRES_DB: foodorder_test
          options: >-
            --health-cmd "pg_isready -U postgres"
            --health-interval 10s
            --health-timeout 5s
            --health-retries 5
  
      env:
        MIX_ENV: test
        DATABASE_URL: "Host=localhost;Username=postgres;Password=postgres;Database=foodorder_test"
  
      steps:
        - name: ðŸ“¥ Checkout do cÃ³digo
          uses: actions/checkout@v3
  
        - name: Setup .NET 9.0 SDK
          uses: actions/setup-dotnet@v3
          with:
            dotnet-version: '9.0.x'
  
        - name: ðŸ§ª Restaurar dependÃªncias
          run: dotnet restore fiap-video-manager/VideoManager.sln
  
        - name: ðŸ§± Build do projeto
          run: dotnet build fiap-video-manager/VideoManager.sln --no-restore --configuration Release
  
        - name: ðŸ§ª Rodar testes
          run: dotnet test fiap-video-manager/VideoManager.sln --no-build --verbosity normal
  